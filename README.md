# Spring Demo: Blaze-Persistence + QueryDSL on Spring Boot (Kotlin)

A small Spring Boot 3 (Kotlin) project that demonstrates:
- Type-safe querying with QueryDSL (Jakarta) backed by KSP code generation
- Blaze-Persistence integration for advanced JPA criteria queries
- PostgreSQL JSONB helpers exposed to JPA/Blaze (custom functions)
- Practical Gradle Version Catalog usage with dependency bundles
- Simple REST endpoint and JPA/JDBC repositories
- Testcontainers-based integration tests against PostgreSQL

## What this project is doing
This demo shows how to build a modern Spring Boot data layer combining Blaze-Persistence and QueryDSL on Hibernate 6 with Jakarta APIs. It also registers custom PostgreSQL JSONB functions so you can write expressive queries against JSONB columns using JPA/Blaze.

Specifically, it includes:
- Spring Boot web + data-jpa setup in Kotlin.
- QueryDSL (Jakarta classifier) via KSP for code generation (no kapt needed).
- Blaze-Persistence for criteria-style queries and QueryDSL expression integration.
- Hypersistence Utils (Hibernate 6.3 artifact) for practical Hibernate features.
- Custom JSONB functions for PostgreSQL exposed to JPA/Blaze:
  - `PgJsonbContainsFunction`
  - `PgJsonbContainsAnyOfFunction`
  - `PgJsonbPathQueryArrayFunction`
- Integration tests using Testcontainers PostgreSQL.

## Tech stack and build
- Kotlin, Spring Boot 3, Hibernate 6, JPA (Jakarta)
- Blaze-Persistence, QueryDSL (jakarta), KSP codegen
- Hypersistence Utils, PostgreSQL
- Gradle with Version Catalog and bundles (see `gradle/libs.versions.toml`)

Key Gradle bits:
- Dependency bundles group common libraries:
  - `bundles.spring-starters` for web + data-jpa + Jackson + Kotlin reflect
  - `bundles.blaze-querydsl` for Blaze-Persistence modules
  - `bundles.testing.core` and `bundles.testcontainers` for tests
- QueryDSL JPA Jakarta is added with a classifier that TOML cannot express, so the build uses:
  - `implementation(variantOf(libs.querydsl.jpa) { classifier("jakarta") })`
- KSP is used for QueryDSL code generation: `ksp(libs.querydsl.ksp.codegen)`

See `build.gradle.kts` for details.

## Code map
- App entry point: `src/main/kotlin/org/example/spring/demo/SpringDemoApplication.kt`
- Simple controller: `src/main/kotlin/org/example/spring/demo/controller/TestController.kt`
- Data model: `src/main/kotlin/org/example/spring/demo/dao/model/OrderEntity.kt`
- JPA repo: `src/main/kotlin/org/example/spring/demo/dao/OrderJpaRepository.kt`
- JDBC repo: `src/main/kotlin/org/example/spring/demo/dao/OrderJdbcRepository.kt`
- Blaze/QueryDSL config: `src/main/kotlin/org/example/spring/demo/dao/BlazePersistenceConfig.kt`
- Custom PostgreSQL JSONB functions:
  - `src/main/kotlin/org/example/spring/demo/dao/jpql/PgJsonbContainsFunction.kt`
  - `src/main/kotlin/org/example/spring/demo/dao/jpql/PgJsonbContainsAnyOfFunction.kt`
  - `src/main/kotlin/org/example/spring/demo/dao/jpql/PgJsonbPathQueryArrayFunction.kt`

## Run it
Prerequisites: JDK 21

- Build: `./gradlew build`
- Run app: `./gradlew bootRun`

Configuration is in `src/main/resources/application.yml`. The app expects PostgreSQL; tests will start their own database via Testcontainers.

## Tests
- Unit and integration tests: `./gradlew test`
- Testcontainers spins up a PostgreSQL instance for integration tests.

## Dependency updates
You can check for newer stable dependency versions using the Versions plugin:
- `./gradlew dependencyUpdates --refresh-dependencies`

## Notes
- QueryDSL Q-classes are generated by KSP during build; no special steps are required.
- The project uses ktlint for formatting: `./gradlew ktlintCheck` / `ktlintFormat`.

## Disclaimer
Portions of this repository were generated with assistance from Junie, an AI programming assistant by JetBrains. All AI-generated content was reviewed and integrated by a human maintainer.
